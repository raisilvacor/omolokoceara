{% extends "admin/base.html" %}

{% block title %}Editar Sobre - Omoloko Ceará Admin{% endblock %}

{% block content %}
<div class="edit-header">
    <h1>Editar: Sobre o Omoloko Ceará</h1>
    <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">Voltar</a>
</div>

<form method="POST" class="edit-form" id="sobre-form">
    <h2>Informações da Página</h2>
    <div class="form-group">
        <label for="page_title">Título da Página</label>
        <input type="text" id="page_title" name="page_title" value="{{ data.title or 'Sobre o Omoloko Ceará' }}" required>
    </div>
    
    <div class="form-group">
        <label for="page_subtitle">Subtítulo da Página</label>
        <input type="text" id="page_subtitle" name="page_subtitle" value="{{ data.subtitle or '' }}" required>
    </div>
    
    <h2>Nossa História</h2>
    <div class="card-item">
        <div class="form-group">
            <label for="historia_title">Título da Seção</label>
            <input type="text" id="historia_title" name="historia_title" value="{{ data.historia.title if data.historia else 'Nossa História' }}" required>
        </div>
        
        <div id="historia-paragraphs">
            {% if data.historia and data.historia.paragraphs %}
                {% for para in data.historia.paragraphs %}
                <div class="paragraph-item">
                    <div class="form-group">
                        <label>Parágrafo {{ loop.index }}</label>
                        <textarea name="historia_para_{{ loop.index0 }}" rows="3" required>{{ para }}</textarea>
                        <button type="button" class="btn btn-danger btn-small" onclick="removeParagraph(this)">Remover</button>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="paragraph-item">
                    <div class="form-group">
                        <label>Parágrafo 1</label>
                        <textarea name="historia_para_0" rows="3" required></textarea>
                        <button type="button" class="btn btn-danger btn-small" onclick="removeParagraph(this)">Remover</button>
                    </div>
                </div>
            {% endif %}
        </div>
        <input type="hidden" id="historia_paragraph_count" name="historia_paragraph_count" value="{{ data.historia.paragraphs|length if data.historia and data.historia.paragraphs else 1 }}">
        <button type="button" class="btn btn-secondary" onclick="addParagraph()">Adicionar Parágrafo</button>
    </div>
    
    <h2>Nossa Missão</h2>
    <div class="card-item">
        <div class="form-group">
            <label for="missao_title">Título da Seção</label>
            <input type="text" id="missao_title" name="missao_title" value="{{ data.missao.title if data.missao else 'Nossa Missão' }}" required>
        </div>
        
        <div class="form-group">
            <label for="missao_intro">Texto Introdutório</label>
            <textarea id="missao_intro" name="missao_intro" rows="2" required>{{ data.missao.intro if data.missao else '' }}</textarea>
        </div>
        
        <div id="missao-list">
            <label>Itens da Lista</label>
            {% if data.missao and data.missao.list %}
                {% for item in data.missao.list %}
                <div class="list-item">
                    <div class="form-group">
                        <input type="text" name="missao_item_{{ loop.index0 }}" value="{{ item }}" required>
                        <button type="button" class="btn btn-danger btn-small" onclick="removeListItem(this)">Remover</button>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="list-item">
                    <div class="form-group">
                        <input type="text" name="missao_item_0" required>
                        <button type="button" class="btn btn-danger btn-small" onclick="removeListItem(this)">Remover</button>
                    </div>
                </div>
            {% endif %}
        </div>
        <input type="hidden" id="missao_list_count" name="missao_list_count" value="{{ data.missao.list|length if data.missao and data.missao.list else 1 }}">
        <button type="button" class="btn btn-secondary" onclick="addListItem()">Adicionar Item</button>
    </div>
    
    <h2>Nossos Valores</h2>
    <div class="card-item">
        <div class="form-group">
            <label for="valores_title">Título da Seção</label>
            <input type="text" id="valores_title" name="valores_title" value="{{ data.valores.title if data.valores else 'Nossos Valores' }}" required>
        </div>
        
        {% for i in range(4) %}
        <div class="value-item-edit">
            <h3>Valor {{ i + 1 }}</h3>
            <div class="form-group">
                <label for="valor_title_{{ i }}">Título</label>
                <input type="text" id="valor_title_{{ i }}" name="valor_title_{{ i }}" value="{{ data.valores.items[i].title if data.valores and data.valores.items and data.valores.items[i] else '' }}" required>
            </div>
            <div class="form-group">
                <label for="valor_desc_{{ i }}">Descrição</label>
                <textarea id="valor_desc_{{ i }}" name="valor_desc_{{ i }}" rows="2" required>{{ data.valores.items[i].description if data.valores and data.valores.items and data.valores.items[i] else '' }}</textarea>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <h2>Nossa Visão</h2>
    <div class="card-item">
        <div class="form-group">
            <label for="visao_title">Título da Seção</label>
            <input type="text" id="visao_title" name="visao_title" value="{{ data.visao.title if data.visao else 'Nossa Visão' }}" required>
        </div>
        
        <div class="form-group">
            <label for="visao_content">Conteúdo</label>
            <textarea id="visao_content" name="visao_content" rows="4" required>{{ data.visao.content if data.visao else '' }}</textarea>
        </div>
    </div>
    
    <button type="submit" class="btn btn-primary">Salvar Alterações</button>
</form>

<script>
function addParagraph() {
    const container = document.getElementById('historia-paragraphs');
    const count = container.children.length;
    const paraDiv = document.createElement('div');
    paraDiv.className = 'paragraph-item';
    paraDiv.innerHTML = `
        <div class="form-group">
            <label>Parágrafo ${count + 1}</label>
            <textarea name="historia_para_${count}" rows="3" required></textarea>
            <button type="button" class="btn btn-danger btn-small" onclick="removeParagraph(this)">Remover</button>
        </div>
    `;
    container.appendChild(paraDiv);
    document.getElementById('historia_paragraph_count').value = count + 1;
}

function removeParagraph(btn) {
    btn.closest('.paragraph-item').remove();
    const container = document.getElementById('historia-paragraphs');
    document.getElementById('historia_paragraph_count').value = container.children.length;
    // Renumerar labels
    container.querySelectorAll('.paragraph-item').forEach((item, index) => {
        item.querySelector('label').textContent = `Parágrafo ${index + 1}`;
    });
}

function addListItem() {
    const container = document.getElementById('missao-list');
    const count = container.querySelectorAll('.list-item').length;
    const itemDiv = document.createElement('div');
    itemDiv.className = 'list-item';
    itemDiv.innerHTML = `
        <div class="form-group">
            <input type="text" name="missao_item_${count}" required>
            <button type="button" class="btn btn-danger btn-small" onclick="removeListItem(this)">Remover</button>
        </div>
    `;
    container.appendChild(itemDiv);
    document.getElementById('missao_list_count').value = count + 1;
}

function removeListItem(btn) {
    btn.closest('.list-item').remove();
    const container = document.getElementById('missao-list');
    document.getElementById('missao_list_count').value = container.querySelectorAll('.list-item').length;
}
</script>

<style>
.paragraph-item, .list-item {
    margin-bottom: 1rem;
    padding: 1rem;
    background: white;
    border-radius: 5px;
    border: 1px solid #e0e0e0;
}

.value-item-edit {
    margin-bottom: 1.5rem;
    padding: 1rem;
    background: white;
    border-radius: 5px;
    border-left: 4px solid #228B22;
}

.value-item-edit h3 {
    margin-bottom: 1rem;
    color: #1a1a1a;
}

.btn-small {
    padding: 0.4rem 0.8rem;
    font-size: 0.85rem;
    margin-top: 0.5rem;
}

.form-group input[type="text"] {
    margin-bottom: 0.5rem;
}
</style>
{% endblock %}
